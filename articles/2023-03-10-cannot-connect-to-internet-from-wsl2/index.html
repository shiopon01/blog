<!DOCTYPE html><html lang="ja" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="shiopon blog" href="https://blog.shiopon.net/rss.xml"><meta name="generator" content="Astro v5.16.11"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://blog.shiopon.net/articles/2023-03-10-cannot-connect-to-internet-from-wsl2/"><!-- Primary Meta Tags --><title>WindowsがVPNに繋がっているとWSL2がネットに繋がらない問題の解決</title><meta name="title" content="WindowsがVPNに繋がっているとWSL2がネットに繋がらない問題の解決"><meta name="description" content="Windows WSL2 \+ VPN \= cannot connect to internet"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://blog.shiopon.net/articles/2023-03-10-cannot-connect-to-internet-from-wsl2/"><meta property="og:title" content="WindowsがVPNに繋がっているとWSL2がネットに繋がらない問題の解決"><meta property="og:description" content="Windows WSL2 \+ VPN \= cannot connect to internet"><meta property="og:image" content="https://blog.shiopon.net/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://blog.shiopon.net/articles/2023-03-10-cannot-connect-to-internet-from-wsl2/"><meta property="twitter:title" content="WindowsがVPNに繋がっているとWSL2がネットに繋がらない問題の解決"><meta property="twitter:description" content="Windows WSL2 \+ VPN \= cannot connect to internet"><meta property="twitter:image" content="https://blog.shiopon.net/blog-placeholder-1.jpg"><style>:root{--accent: #64b5f6;--accent-dark: #42a5f5;--bg-main: #1a1a1a;--bg-secondary: #242424;--bg-tertiary: #2d2d2d;--text-primary: #e0e0e0;--text-secondary: #b0b0b0;--text-muted: #808080;--border-color: #404040;--code-bg: #2a2a2a;--blockquote-bg: #252525;--black: 224, 224, 224;--gray: 176, 176, 176;--gray-light: 64, 64, 64;--gray-dark: 128, 128, 128;--box-shadow: 0 2px 6px rgba(0, 0, 0, .3), 0 8px 24px rgba(0, 0, 0, .15), 0 16px 32px rgba(0, 0, 0, .1)}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;margin:0;padding:0;text-align:left;background:var(--bg-main);word-wrap:break-word;overflow-wrap:break-word;color:var(--text-primary);font-size:18px;line-height:1.7;min-height:100vh;display:flex;flex-direction:column}main{width:720px;max-width:calc(100% - 2em);margin:auto;padding:3em 1em;flex:1}h1,h2,h3,h4,h5,h6{margin:0 0 .5rem;color:var(--text-primary);line-height:1.2}h1{font-size:2.5em}h2{font-size:2em}h3{font-size:1.5em}h4{font-size:1.25em}h5{font-size:1.1em}strong,b{font-weight:700;color:var(--text-primary)}a{color:var(--accent)}a:hover{color:var(--accent-dark)}p{margin-bottom:1em}.prose p{margin-bottom:2em}textarea{width:100%;font-size:16px;background:var(--bg-secondary);color:var(--text-primary);border:1px solid var(--border-color)}input{font-size:16px;background:var(--bg-secondary);color:var(--text-primary);border:1px solid var(--border-color)}table{width:100%;border-collapse:collapse}table th,table td{border:1px solid var(--border-color);padding:.5em}table th{background:var(--bg-secondary)}img{max-width:100%;height:auto;border-radius:8px}code{padding:2px 5px;background-color:var(--code-bg);color:#ff6b6b;border-radius:2px;font-family:SF Mono,Monaco,Cascadia Code,Roboto Mono,Consolas,Courier New,monospace}pre{padding:1.5em;border-radius:8px;background:var(--code-bg);border:1px solid var(--border-color);overflow-x:auto}pre>code{all:unset;color:var(--text-primary)}blockquote{border-left:4px solid var(--accent);margin:0;font-size:1.1em;background:var(--blockquote-bg);padding:1em 1.5em;border-radius:4px;font-style:italic}hr{border:none;border-top:1px solid var(--border-color)}@media(max-width:720px){body{font-size:16px}main{padding:1em}h1{font-size:2em}h2{font-size:1.5em}h3{font-size:1.25em}}.sr-only{border:0;padding:0;margin:0;position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap}a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}header[data-astro-cid-3ef6ksr2]{margin:0;padding:0 1em;background:var(--bg-secondary);border-bottom:1px solid var(--border-color)}h2[data-astro-cid-3ef6ksr2]{margin:0;font-size:1em}h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2],h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none;color:var(--text-primary)}nav[data-astro-cid-3ef6ksr2]{display:flex;align-items:center;justify-content:space-between}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{padding:1em .5em;color:var(--text-secondary);border-bottom:2px solid transparent;text-decoration:none;font-size:.9rem;transition:color .2s ease}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]:hover{color:var(--accent)}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none;border-bottom-color:var(--accent);color:var(--accent)}.internal-links[data-astro-cid-3ef6ksr2]{display:flex;gap:1rem}@media(max-width:720px){nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{padding:.75em .25em;font-size:.85rem}.internal-links[data-astro-cid-3ef6ksr2]{gap:.5rem}}footer[data-astro-cid-sz7xmlte]{padding:2em 1em;background:#242424;border-top:1px solid #404040;color:gray;text-align:center;font-size:.9rem}p[data-astro-cid-sz7xmlte]{margin:0;color:gray}
</style>
<link rel="stylesheet" href="/_astro/_slug_.Bs7qlZ2u.css"></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <h2 data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2>shiopon blog</a></h2> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Home </a>  <a href="/articles" class="active" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Blog </a>  <a href="/about" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> About </a>  </div> </nav> </header>  <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <header class="article-header" data-astro-cid-bvzihdzo> <p class="kicker" data-astro-cid-bvzihdzo>記事</p> <div class="title" data-astro-cid-bvzihdzo> <h1 data-astro-cid-bvzihdzo>WindowsがVPNに繋がっているとWSL2がネットに繋がらない問題の解決</h1> </div> <p class="lead" data-astro-cid-bvzihdzo>Windows WSL2 \+ VPN \= cannot connect to internet</p> <div class="meta" data-astro-cid-bvzihdzo> <span class="date" data-astro-cid-bvzihdzo> <time datetime="2023-03-10T00:00:00.000Z"> 2023-03-10 </time> </span>  </div> </header>  <div class="prose" data-astro-cid-bvzihdzo>  <p>最近仕事でPulse SecureでVPNに接続した状態で作業することが多いのだけど、VPNに繋いだらWSL2のUbuntuがインターネットに繋がらなくなることに気がついた。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>$ curl example.com  </span></span>
<span class="line"><span>curl: (6) Could not resolve host: example.com  </span></span></code></pre>
<p>VPNに繋ぐとインターネットに繋がらなくなる問題はどうも自分だけじゃないようで、GitHubのissueでも沢山報告されていた。</p>
<p><a href="https://github.com/microsoft/WSL/issues/5068">WSL2 , problem with network connection when VPN used (PulseSecure) · Issue #5068 · microsoft/WSL (github.com)</a></p>
<h2 id="解決方法">解決方法</h2>
<p>根本的な解決ではないかもしれないが、とりあえずこのツールが役に立った。調べるとホスト側とディストリビューション側で長いスクリプトを実行する…とか、ホスト側にツールをインストールしてトンネルする…とかあったが、これはWSL2でAlpineを立ち上げるだけで良い。</p>
<p><a href="https://github.com/sakai135/wsl-vpnkit">sakai135/wsl-vpnkit: Provides network connectivity to WSL 2 when blocked by VPN (github.com)</a></p>
<p>使い方はREADME.mdに書いている通りで、まずは <a href="https://github.com/sakai135/wsl-vpnkit/releases/">リリースページ</a> から wsl-vpnkit.tar.gz をダウンロードしてPowershellなどからWSL2にインポートする。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>\> wsl --import wsl-vpnkit --version 2 $env:USERPROFILE\\wsl-vpnkit wsl-vpnkit.tar.gz  </span></span></code></pre>
<p>インポート後、インターネットに繋ぎたいディストリビューション内から起動コマンドを実行する。（この起動コマンドはWSL2を起動するたびに実行する必要がある。）</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>$ wsl.exe -d wsl-vpnkit --cd /app service wsl-vpnkit start  </span></span></code></pre>
<p>自分の場合はこれに加えてnameserverの変更が必要だった。アドレスをGoogle Public DNSなど適当なIPアドレスに変更する。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>$ sudo vi /etc/resolv.conf  </span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>nameserver 8.8.8.8  </span></span></code></pre>
<p>resolv.confはディストリビューションを立ち上げるたび新しいものに更新されてしまうので、更新されないようWSL2の設定ファイルで自動生成をオフにする。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>$ sudo vi /etc/wsl.conf  </span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>[network]  </span></span>
<span class="line"><span>generateResolvConf = false  </span></span></code></pre>
<p>resolv.confは（おそらく）ディストリビューションを終了した時に削除され、自動生成がオフだと立ち上げ時に作成されず、存在しない状態になってしまうので、chattrで変更を禁止して消せないファイルに変更しておく。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>$ sudo chattr +i /etc/resolv.conf  </span></span></code></pre>
<p>これでディストリビューションがインターネットに繋がるはず。</p>  </div> <!-- シェアボタン --> <div class="share-section" data-astro-cid-bvzihdzo> <h3 class="share-title" data-astro-cid-bvzihdzo>Share</h3> <div class="share-buttons" data-astro-cid-bvzihdzo> <a href="https://twitter.com/intent/tweet?text=Windows%E3%81%8CVPN%E3%81%AB%E7%B9%8B%E3%81%8C%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%A8WSL2%E3%81%8C%E3%83%8D%E3%83%83%E3%83%88%E3%81%AB%E7%B9%8B%E3%81%8C%E3%82%89%E3%81%AA%E3%81%84%E5%95%8F%E9%A1%8C%E3%81%AE%E8%A7%A3%E6%B1%BA%20%7C%20shiopon%20blog&url=https%3A%2F%2Fblog.shiopon.net%2Farticles%2F2023-03-10-cannot-connect-to-internet-from-wsl2%2F" target="_blank" rel="noopener noreferrer" class="share-button twitter" title="Twitterでシェア" data-astro-cid-bvzihdzo> <svg class="share-icon" viewBox="0 0 24 24" data-astro-cid-bvzihdzo> <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" data-astro-cid-bvzihdzo></path> </svg> </a> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.shiopon.net%2Farticles%2F2023-03-10-cannot-connect-to-internet-from-wsl2%2F" target="_blank" rel="noopener noreferrer" class="share-button facebook" title="Facebookでシェア" data-astro-cid-bvzihdzo> <svg class="share-icon" viewBox="0 0 24 24" data-astro-cid-bvzihdzo> <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" data-astro-cid-bvzihdzo></path> </svg> </a> <a href="https://b.hatena.ne.jp/entry/s/blog.shiopon.net/articles/2023-03-10-cannot-connect-to-internet-from-wsl2/" target="_blank" rel="noopener noreferrer" class="share-button hatena" title="はてなブックマーク" data-astro-cid-bvzihdzo> <svg class="share-icon" viewBox="0 0 24 24" data-astro-cid-bvzihdzo> <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zM8.5 17.5c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zm7-8.5H13V6h2.5v3z" data-astro-cid-bvzihdzo></path> </svg> </a> </div> </div> </article> </main> <footer data-astro-cid-sz7xmlte> <p data-astro-cid-sz7xmlte>&copy; 2026 https://blog.shiopon.net. All rights reserved.</p> </footer>  </body></html>